<template>
    <table class="settings-autoresponder-table">
        <tr>
            <th>Название</th>
            <th>Статус</th>
            <th>Дата создания</th>
            <th>Дата обновления</th>
            <th>Опции</th>
        </tr>
        <tr v-for="autoresponder in autoresponders"
            :key="autoresponder.autoresponder_id"
        >
            <td>{{autoresponder.name}}</td>
            <td>{{autoresponder.status}}</td>
            <td>{{validDate(autoresponder.created_at, true)}}</td>
            <td>{{validDate(autoresponder.updated_at, true)}}</td>
            <td>
                <div class="settings-autoresponder-table__actions-container">
                    <div v-if="autoresponder.is_enabled"
                         class="settings-autoresponder-table__action pointer"
                         @click="stop(autoresponder.autoresponder_id)"
                    >
                        <svg width="19" height="19" viewBox="0 0 19 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M1.03374 0.811558C1.69563 0.291926 2.59335 0 3.52941 0C4.46547 0 5.36319 0.291926 6.02508 0.811558C6.68698 1.33119 7.05882 2.03596 7.05882 2.77083V16.2292C7.05882 16.964 6.68698 17.6688 6.02508 18.1884C5.36319 18.7081 4.46547 19 3.52941 19C2.59335 19 1.69563 18.7081 1.03374 18.1884C0.371848 17.6688 0 16.964 0 16.2292V2.77083C0 2.03596 0.371848 1.33119 1.03374 0.811558ZM4.59899 17.0689C4.88265 16.8462 5.04202 16.5441 5.04202 16.2292V2.77083C5.04202 2.45589 4.88265 2.15384 4.59899 1.93114C4.31532 1.70844 3.93058 1.58333 3.52941 1.58333C3.12824 1.58333 2.74351 1.70844 2.45984 1.93114C2.17617 2.15384 2.01681 2.45589 2.01681 2.77083V16.2292C2.01681 16.5441 2.17617 16.8462 2.45984 17.0689C2.74351 17.2916 3.12824 17.4167 3.52941 17.4167C3.93058 17.4167 4.31532 17.2916 4.59899 17.0689ZM12.0926 0.811558C12.7545 0.291926 13.6522 0 14.5883 0C15.5243 0 16.422 0.291926 17.0839 0.811558C17.7458 1.33119 18.1177 2.03596 18.1177 2.77083V16.2292C18.1177 16.964 17.7458 17.6688 17.0839 18.1884C16.422 18.7081 15.5243 19 14.5883 19C13.6522 19 12.7545 18.7081 12.0926 18.1884C11.4307 17.6688 11.0588 16.964 11.0588 16.2292V2.77083C11.0588 2.03596 11.4307 1.33119 12.0926 0.811558ZM15.6578 17.0689C15.9415 16.8462 16.1009 16.5441 16.1009 16.2292V2.77083C16.1009 2.45589 15.9415 2.15384 15.6578 1.93114C15.3742 1.70844 14.9894 1.58333 14.5883 1.58333C14.1871 1.58333 13.8023 1.70844 13.5187 1.93114C13.235 2.15384 13.0756 2.45589 13.0756 2.77083V16.2292C13.0756 16.5441 13.235 16.8462 13.5187 17.0689C13.8023 17.2916 14.1871 17.4167 14.5883 17.4167C14.9894 17.4167 15.3742 17.2916 15.6578 17.0689Z"
                                  fill="#9797BB"/>
                        </svg>
                    </div>
                    <div v-else
                         class="settings-autoresponder-table__action pointer"
                         @click="restore(autoresponder.autoresponder_id)"
                    >
                        <svg width="17" height="20" viewBox="0 0 17 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M15.2198 6.63908L6.92001 0.805027C6.27176 0.350291 5.50471 0.0764315 4.70391 0.0138145C3.9031 -0.0488024 3.09984 0.10227 2.3832 0.45028C1.66655 0.798291 1.06452 1.32964 0.643853 1.98541C0.223191 2.64118 0.000335834 3.39575 0 4.16544V15.8336C0.000143352 16.6036 0.223011 17.3585 0.643868 18.0146C1.06473 18.6707 1.66711 19.2022 2.38418 19.5502C3.10124 19.8982 3.90493 20.049 4.70606 19.986C5.50719 19.923 6.27443 19.6485 6.92262 19.1931L15.2225 13.3591C15.7734 12.972 16.2214 12.4661 16.5303 11.8823C16.8391 11.2985 17 10.6532 17 9.99867C17 9.34417 16.8391 8.69887 16.5303 8.11505C16.2214 7.53123 15.7734 7.0253 15.2225 6.63825L15.2198 6.63908ZM14.1898 12.0148L5.88993 17.8488C5.50105 18.121 5.04112 18.2849 4.56106 18.3222C4.08099 18.3595 3.59951 18.2688 3.16992 18.0602C2.74032 17.8516 2.37936 17.5331 2.12699 17.1402C1.87462 16.7472 1.74068 16.295 1.74001 15.8336V4.16544C1.73518 3.70318 1.86659 3.24898 2.11913 2.85505C2.37168 2.46112 2.73512 2.14343 3.16768 1.9385C3.5356 1.75922 3.94246 1.66557 4.35524 1.66513C4.90847 1.66716 5.44641 1.83923 5.88993 2.15603L14.1898 7.99008C14.5199 8.22236 14.7884 8.52582 14.9734 8.87592C15.1584 9.22602 15.2549 9.61292 15.2549 10.0053C15.2549 10.3977 15.1584 10.7847 14.9734 11.1348C14.7884 11.4848 14.5199 11.7883 14.1898 12.0206V12.0148Z"
                                  fill="#9797BB"/>
                        </svg>
                    </div>
                    <div class="settings-autoresponder-table__action pointer"
                        @click="edit(autoresponder.autoresponder_id)"
                    >
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M18.5774 7.72657C18.7337 7.57029 18.9456 7.48249 19.1667 7.48249C19.3877 7.48249 19.5996 7.57029 19.7559 7.72657C19.9122 7.88285 20 8.09481 20 8.31583V13.6192C20.0013 14.1665 19.8941 14.7087 19.6846 15.2143C19.475 15.72 19.1673 16.179 18.7792 16.565L16.5658 18.78C16.1797 19.1681 15.7205 19.4757 15.2147 19.6851C14.7089 19.8945 14.1666 20.0015 13.6192 20H4.16666C3.062 19.9987 2.00296 19.5592 1.22185 18.7781C0.440735 17.997 0.00132321 16.938 0 15.8333V4.16666C0.00132321 3.062 0.440735 2.00296 1.22185 1.22185C2.00296 0.440735 3.062 0.00132321 4.16666 0H11.7017C11.9227 0 12.1346 0.0877973 12.2909 0.244077C12.4472 0.400358 12.535 0.612319 12.535 0.833333C12.535 1.05435 12.4472 1.26631 12.2909 1.42259C12.1346 1.57887 11.9227 1.66667 11.7017 1.66667H4.16666C3.50362 1.66667 2.86774 1.93006 2.3989 2.3989C1.93006 2.86774 1.66667 3.50362 1.66667 4.16666V15.8333C1.66667 16.4964 1.93006 17.1322 2.3989 17.6011C2.86774 18.0699 3.50362 18.3333 4.16666 18.3333H12.5V15C12.5 14.3369 12.7634 13.7011 13.2322 13.2322C13.7011 12.7634 14.3369 12.5 15 12.5H18.3333V8.31583C18.3333 8.09481 18.4211 7.88285 18.5774 7.72657ZM14.1667 18.2683C14.6289 18.1672 15.0525 17.9358 15.3875 17.6017L17.6042 15.3867C17.9367 15.0508 18.1677 14.6279 18.2708 14.1667H15C14.779 14.1667 14.567 14.2545 14.4107 14.4107C14.2545 14.567 14.1667 14.779 14.1667 15V18.2683ZM5.3867 10.935L15.5467 0.775039C16.042 0.301618 16.7007 0.0374146 17.3859 0.0374146C18.071 0.0374146 18.7298 0.301618 19.225 0.775039C19.712 1.26323 19.9855 1.92464 19.9855 2.6142C19.9855 3.30377 19.712 3.96518 19.225 4.45337L9.06503 14.6134C8.67907 15.0014 8.21998 15.309 7.71433 15.5185C7.20867 15.7279 6.6665 15.8349 6.1192 15.8334H5.00003C4.77902 15.8334 4.56706 15.7456 4.41078 15.5893C4.2545 15.433 4.1667 15.221 4.1667 15V13.8809C4.16515 13.3336 4.27218 12.7914 4.4816 12.2857C4.69101 11.7801 4.99865 11.321 5.3867 10.935ZM7.8867 13.435L18.0467 3.27504C18.2216 3.09961 18.3199 2.86196 18.3199 2.6142C18.3199 2.36645 18.2216 2.1288 18.0467 1.95337C17.8687 1.78333 17.632 1.68845 17.3859 1.68845C17.1397 1.68845 16.903 1.78333 16.725 1.95337L6.56503 12.1134C6.098 12.5833 5.8351 13.2184 5.83336 13.8809V14.1667H6.1192C6.7817 14.165 7.4168 13.9021 7.8867 13.435Z"
                                  fill="#9797BB"/>
                        </svg>
                    </div>
                    <div class="settings-autoresponder-table__action pointer"
                        @click="del(autoresponder)"
                    >
                        <svg width="18" height="20" viewBox="0 0 18 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M17.1 3.33333H14.31C14.1011 2.39284 13.5484 1.54779 12.7451 0.940598C11.9418 0.333408 10.937 0.0012121 9.9 0H8.1C7.06302 0.0012121 6.05819 0.333408 5.25487 0.940598C4.45156 1.54779 3.89889 2.39284 3.69 3.33333H0.9C0.661305 3.33333 0.432387 3.42113 0.263604 3.57741C0.0948211 3.73369 0 3.94565 0 4.16667C0 4.38768 0.0948211 4.59964 0.263604 4.75592C0.432387 4.9122 0.661305 5 0.9 5H1.8V15.8333C1.80143 16.938 2.27599 17.997 3.1196 18.7782C3.9632 19.5593 5.10696 19.9987 6.3 20H11.7C12.893 19.9987 14.0368 19.5593 14.8804 18.7782C15.724 17.997 16.1986 16.938 16.2 15.8333V5H17.1C17.3387 5 17.5676 4.9122 17.7364 4.75592C17.9052 4.59964 18 4.38768 18 4.16667C18 3.94565 17.9052 3.73369 17.7364 3.57741C17.5676 3.42113 17.3387 3.33333 17.1 3.33333ZM8.1 1.66667H9.9C10.4582 1.6673 11.0026 1.82781 11.4585 2.1262C11.9143 2.42459 12.2593 2.84624 12.4461 3.33333H5.5539C5.74072 2.84624 6.08571 2.42459 6.54155 2.1262C6.99739 1.82781 7.54175 1.6673 8.1 1.66667ZM14.4 15.8333C14.4 16.4964 14.1155 17.1323 13.6092 17.6011C13.1028 18.0699 12.4161 18.3333 11.7 18.3333H6.3C5.58392 18.3333 4.89716 18.0699 4.39081 17.6011C3.88446 17.1323 3.6 16.4964 3.6 15.8333V5H14.4V15.8333ZM7.20002 14.9999C7.43872 14.9999 7.66763 14.9121 7.83642 14.7558C8.0052 14.5995 8.10002 14.3876 8.10002 14.1666V9.16658C8.10002 8.94557 8.0052 8.73361 7.83642 8.57733C7.66763 8.42105 7.43872 8.33325 7.20002 8.33325C6.96133 8.33325 6.73241 8.42105 6.56363 8.57733C6.39484 8.73361 6.30002 8.94557 6.30002 9.16658V14.1666C6.30002 14.3876 6.39484 14.5995 6.56363 14.7558C6.73241 14.9121 6.96133 14.9999 7.20002 14.9999ZM11.4364 14.7558C11.2676 14.9121 11.0387 14.9999 10.8 14.9999C10.5613 14.9999 10.3324 14.9121 10.1636 14.7558C9.99479 14.5995 9.89997 14.3876 9.89997 14.1666V9.16658C9.89997 8.94557 9.99479 8.73361 10.1636 8.57733C10.3324 8.42105 10.5613 8.33325 10.8 8.33325C11.0387 8.33325 11.2676 8.42105 11.4364 8.57733C11.6052 8.73361 11.7 8.94557 11.7 9.16658V14.1666C11.7 14.3876 11.6052 14.5995 11.4364 14.7558Z"
                                  fill="#EB5757"/>
                        </svg>
                    </div>
                </div>
            </td>
        </tr>
    </table>
</template>

<script>
    import {useMailings} from "../../../composition/useMailings";
    import {useDate} from "../../../composition/useDate";
    import {useAutoresponders} from "../../../composition/useAutoresponder";
    import {useModalConfirmDelete} from "../../../composition/useModalConfirmDelete";

    export default {
        setup(props, {emit}) {
            const { getAutoresponders, autoresponders, deleteAutoresponder, restoreAutoresponder, stopAutoresponder } = useAutoresponders()

            const { setSaveCallbackModalConfirmDelete, setTextModalConfirmDelete, toggleModalConfirmDelete } = useModalConfirmDelete()

            const { validDate } = useDate();
            getAutoresponders();

            const del = (autoresponder) => {
                let callback = () => deleteAutoresponder([autoresponder.autoresponder_id])
                    .then(() => {
                        getAutoresponders();
                    })
                setTextModalConfirmDelete(`Вы точно хотите удалить автоответчик "${autoresponder.name}"?`)
                setSaveCallbackModalConfirmDelete(callback);

                toggleModalConfirmDelete(true);
            }

            const stop = (id) => {
                stopAutoresponder([id])
                    .then(() => {
                        getAutoresponders();
                    })
            }
            const restore = (id) => {
                restoreAutoresponder([id])
                    .then(() => {
                        getAutoresponders();
                    })
            }

            const edit = (id) => {
                emit('gotoCreate', id);
            }

            return {
                getAutoresponders,
                restore,
                stop,
                autoresponders,
                validDate,

                del,
                edit,
            }
        }
    }
</script>

<style lang="scss">
    .settings-autoresponder-table {
        width: 100%;
        border-spacing: 0;
        th {
            font-style: normal;
            font-weight: normal;
            font-size: 16px;
            line-height: 21px;
            color: var(--font-color);
            text-align: left;
            padding: 17px;
            &:first-of-type {
                padding-left: 45px;
            }
            &:last-of-type {
                padding-right: 45px;
                text-align: right;
            }
            border-bottom: 1px solid var(--separator-color);
        }
        td {
            font-style: normal;
            font-weight: normal;
            font-size: 14px;
            line-height: 19px;
            color: var(--search-input-placeholder-color);
            text-align: left;
            padding: 26px 16px;
            &:first-of-type {
                padding-left: 45px;
            }
            &:last-of-type {
                text-align: right;
                padding-right: 45px;
            }
            border-bottom: 1px solid var(--separator-color);
        }
    }
    .settings-autoresponder-table__actions-container {
        display: flex;
        justify-content: flex-end;
        .settings-autoresponder-table__action {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;

            margin-right: 3px;
            &:last-of-type {
                margin-right: 0;
            }
        }

    }
</style>