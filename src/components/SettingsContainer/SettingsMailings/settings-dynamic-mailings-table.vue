<template>
    <div class="settings-mailings-table">
        <div class="settings-mailings-table__table-container" >
            <div class="settings-mailings-table__scroll-container">
                <table class="settings-mailings-table__table">
                <tr>
                    <th>Название</th>
                    <th>Статус</th>
                    <th>Отправ. всего</th>
                    <th>Отправ. за 24 ч</th>
                    <th>Прочитано</th>
                    <th>Ответов</th>
                    <th>Дата создания</th>
                    <th>Дата обновления</th>
                    <th>Опции</th>
                </tr>
                <tr v-for="mailing in dynamicMailings"
                    :key="mailing.mass_sending_id"
                >
                    <td>{{mailing.name}}</td>
                    <td>{{mailing.status}}</td>
                    <td>{{mailing.sent_count}}</td>
                    <td>{{mailing.sent_count}}</td>
                    <td>{{mailing.sent_count}}</td>
                    <td>{{mailing.sent_count}}</td>
                    <td>{{validDate(mailing.created_at, true)}}</td>
                    <td>{{validDate(mailing.updated_at, true)}}</td>
                    <td>
                        <div class="settings-mailings-table__actions-container">
                            <div v-if="mailing.is_enabled"
                                 class="settings-mailings-table__action pointer"
                                 @click="stop(mailing.dynamic_mass_sending_id)"
                            >
                                <svg width="14" height="16" viewBox="0 0 14 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M0.798799 0.683417C1.31026 0.245833 2.00395 0 2.72727 0C3.45059 0 4.14428 0.245833 4.65574 0.683417C5.1672 1.121 5.45454 1.71449 5.45454 2.33333V13.6667C5.45454 14.2855 5.1672 14.879 4.65574 15.3166C4.14428 15.7542 3.45059 16 2.72727 16C2.00395 16 1.31026 15.7542 0.798799 15.3166C0.287337 14.879 0 14.2855 0 13.6667V2.33333C0 1.71449 0.287337 1.121 0.798799 0.683417ZM3.55376 14.3738C3.77296 14.1862 3.8961 13.9319 3.8961 13.6667V2.33333C3.8961 2.06812 3.77296 1.81376 3.55376 1.62623C3.33456 1.43869 3.03726 1.33333 2.72727 1.33333C2.41728 1.33333 2.11998 1.43869 1.90078 1.62623C1.68158 1.81376 1.55844 2.06812 1.55844 2.33333V13.6667C1.55844 13.9319 1.68158 14.1862 1.90078 14.3738C2.11998 14.5613 2.41728 14.6667 2.72727 14.6667C3.03726 14.6667 3.33456 14.5613 3.55376 14.3738ZM9.34427 0.683417C9.85574 0.245833 10.5494 0 11.2727 0C11.9961 0 12.6898 0.245833 13.2012 0.683417C13.7127 1.121 14 1.71449 14 2.33333V13.6667C14 14.2855 13.7127 14.879 13.2012 15.3166C12.6898 15.7542 11.9961 16 11.2727 16C10.5494 16 9.85574 15.7542 9.34427 15.3166C8.83281 14.879 8.54548 14.2855 8.54548 13.6667V2.33333C8.54548 1.71449 8.83281 1.121 9.34427 0.683417ZM12.0992 14.3738C12.3184 14.1862 12.4416 13.9319 12.4416 13.6667V2.33333C12.4416 2.06812 12.3184 1.81376 12.0992 1.62623C11.88 1.43869 11.5827 1.33333 11.2727 1.33333C10.9628 1.33333 10.6655 1.43869 10.4463 1.62623C10.2271 1.81376 10.1039 2.06812 10.1039 2.33333V13.6667C10.1039 13.9319 10.2271 14.1862 10.4463 14.3738C10.6655 14.5613 10.9628 14.6667 11.2727 14.6667C11.5827 14.6667 11.88 14.5613 12.0992 14.3738Z"
                                          fill="var(--font-color)"/>
                                </svg>
                            </div>
                            <div v-else
                                 class="settings-mailings-table__action pointer"
                                 @click="restore(mailing.dynamic_mass_sending_id)"
                            >
                                <svg width="14" height="16" viewBox="0 0 14 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M15.2198 6.63908L6.92001 0.805027C6.27176 0.350291 5.50471 0.0764315 4.70391 0.0138145C3.9031 -0.0488024 3.09984 0.10227 2.3832 0.45028C1.66655 0.798291 1.06452 1.32964 0.643853 1.98541C0.223191 2.64118 0.000335834 3.39575 0 4.16544V15.8336C0.000143352 16.6036 0.223011 17.3585 0.643868 18.0146C1.06473 18.6707 1.66711 19.2022 2.38418 19.5502C3.10124 19.8982 3.90493 20.049 4.70606 19.986C5.50719 19.923 6.27443 19.6485 6.92262 19.1931L15.2225 13.3591C15.7734 12.972 16.2214 12.4661 16.5303 11.8823C16.8391 11.2985 17 10.6532 17 9.99867C17 9.34417 16.8391 8.69887 16.5303 8.11505C16.2214 7.53123 15.7734 7.0253 15.2225 6.63825L15.2198 6.63908ZM14.1898 12.0148L5.88993 17.8488C5.50105 18.121 5.04112 18.2849 4.56106 18.3222C4.08099 18.3595 3.59951 18.2688 3.16992 18.0602C2.74032 17.8516 2.37936 17.5331 2.12699 17.1402C1.87462 16.7472 1.74068 16.295 1.74001 15.8336V4.16544C1.73518 3.70318 1.86659 3.24898 2.11913 2.85505C2.37168 2.46112 2.73512 2.14343 3.16768 1.9385C3.5356 1.75922 3.94246 1.66557 4.35524 1.66513C4.90847 1.66716 5.44641 1.83923 5.88993 2.15603L14.1898 7.99008C14.5199 8.22236 14.7884 8.52582 14.9734 8.87592C15.1584 9.22602 15.2549 9.61292 15.2549 10.0053C15.2549 10.3977 15.1584 10.7847 14.9734 11.1348C14.7884 11.4848 14.5199 11.7883 14.1898 12.0206V12.0148Z"
                                          fill="var(--font-color)"/>
                                </svg>

                            </div>
                            <div class="settings-mailings-table__action pointer"
                                 @click="edit(mailing.dynamic_mass_sending_id)"
                            >
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M14.8619 6.18126C14.9869 6.05623 15.1565 5.986 15.3333 5.986C15.5101 5.986 15.6797 6.05623 15.8047 6.18126C15.9298 6.30628 16 6.47585 16 6.65266V10.8953C16.0011 11.3332 15.9153 11.7669 15.7477 12.1715C15.58 12.576 15.3338 12.9432 15.0233 13.252L13.2527 15.024C12.9438 15.3344 12.5764 15.5806 12.1717 15.7481C11.7671 15.9156 11.3333 16.0012 10.8953 16H3.33333C2.4496 15.9989 1.60237 15.6474 0.977479 15.0225C0.352588 14.3976 0.00105857 13.5504 0 12.6667V3.33333C0.00105857 2.4496 0.352588 1.60237 0.977479 0.977479C1.60237 0.352588 2.4496 0.00105857 3.33333 0H9.36133C9.53814 0 9.70771 0.0702379 9.83273 0.195262C9.95776 0.320286 10.028 0.489855 10.028 0.666666C10.028 0.843477 9.95776 1.01305 9.83273 1.13807C9.70771 1.26309 9.53814 1.33333 9.36133 1.33333H3.33333C2.8029 1.33333 2.29419 1.54405 1.91912 1.91912C1.54405 2.29419 1.33333 2.8029 1.33333 3.33333V12.6667C1.33333 13.1971 1.54405 13.7058 1.91912 14.0809C2.29419 14.4559 2.8029 14.6667 3.33333 14.6667H9.99999V12C9.99999 11.4696 10.2107 10.9609 10.5858 10.5858C10.9609 10.2107 11.4696 9.99999 12 9.99999H14.6667V6.65266C14.6667 6.47585 14.7369 6.30628 14.8619 6.18126ZM11.3333 14.6147C11.7031 14.5337 12.042 14.3487 12.31 14.0813L14.0833 12.3093C14.3493 12.0406 14.5342 11.7023 14.6167 11.3333H12C11.8232 11.3333 11.6536 11.4036 11.5286 11.5286C11.4036 11.6536 11.3333 11.8232 11.3333 12V14.6147ZM4.30923 8.74809L12.4372 0.620094C12.8334 0.241357 13.3604 0.0299944 13.9086 0.0299944C14.4567 0.0299944 14.9837 0.241357 15.3799 0.620094C15.7695 1.01065 15.9883 1.53978 15.9883 2.09143C15.9883 2.64308 15.7695 3.17221 15.3799 3.56276L7.2519 11.6908C6.94313 12.0012 6.57586 12.2473 6.17133 12.4148C5.76681 12.5824 5.33307 12.668 4.89523 12.6668H3.9999C3.82309 12.6668 3.65352 12.5965 3.52849 12.4715C3.40347 12.3465 3.33323 12.1769 3.33323 12.0001V11.1048C3.33199 10.6669 3.41762 10.2332 3.58515 9.82865C3.75268 9.42412 3.99879 9.05685 4.30923 8.74809ZM6.30923 10.7481L14.4372 2.62009C14.5772 2.47975 14.6558 2.28963 14.6558 2.09143C14.6558 1.89322 14.5772 1.7031 14.4372 1.56276C14.2948 1.42673 14.1055 1.35082 13.9086 1.35082C13.7116 1.35082 13.5223 1.42673 13.3799 1.56276L5.2519 9.69075C4.87827 10.0667 4.66795 10.5747 4.66656 11.1048V11.3334H4.89523C5.42523 11.332 5.93331 11.1217 6.30923 10.7481Z"
                                          fill="var(--font-color)"/>
                                </svg>

                            </div>
                            <div class="settings-mailings-table__action pointer"
                            >
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M3.33333 14.6667H4.66667C4.84348 14.6667 5.01305 14.7369 5.13807 14.8619C5.2631 14.987 5.33333 15.1565 5.33333 15.3333C5.33333 15.5101 5.2631 15.6797 5.13807 15.8047C5.01305 15.9298 4.84348 16 4.66667 16H3.33333C2.4496 15.9989 1.60237 15.6474 0.97748 15.0225C0.352588 14.3976 0.00105857 13.5504 0 12.6667V3.33333C0.00105857 2.4496 0.352588 1.60237 0.97748 0.97748C1.60237 0.352588 2.4496 0.00105857 3.33333 0H4.66667C4.84348 0 5.01305 0.0702379 5.13807 0.195262C5.2631 0.320286 5.33333 0.489856 5.33333 0.666667C5.33333 0.843478 5.2631 1.01305 5.13807 1.13807C5.01305 1.2631 4.84348 1.33333 4.66667 1.33333H3.33333C2.8029 1.33333 2.29419 1.54405 1.91912 1.91912C1.54405 2.29419 1.33333 2.8029 1.33333 3.33333V12.6667C1.33333 13.1971 1.54405 13.7058 1.91912 14.0809C2.29419 14.456 2.8029 14.6667 3.33333 14.6667ZM12.6287 3.48995L15.2202 6.09354H15.2175C15.7185 6.59702 16 7.27979 16 7.9917C16 8.70362 15.7185 9.38639 15.2175 9.88986L12.626 12.4935C12.5644 12.5576 12.4907 12.6087 12.4092 12.6439C12.3277 12.679 12.24 12.6976 12.1513 12.6983C12.0626 12.6991 11.9746 12.6821 11.8925 12.6484C11.8104 12.6146 11.7358 12.5648 11.6731 12.5018C11.6103 12.4388 11.5607 12.3638 11.5271 12.2813C11.4935 12.1988 11.4766 12.1105 11.4774 12.0213C11.4782 11.9322 11.4966 11.8441 11.5316 11.7622C11.5666 11.6804 11.6175 11.6063 11.6813 11.5444L14.2728 8.94078C14.3616 8.84865 14.4367 8.74423 14.496 8.63069C14.4877 8.6313 14.48 8.63363 14.4722 8.63595C14.4631 8.63869 14.454 8.64143 14.4439 8.64143L3.96962 8.6629C3.79244 8.6629 3.62251 8.59219 3.49722 8.46631C3.37192 8.34044 3.30154 8.16972 3.30154 7.9917C3.30154 7.81369 3.37192 7.64297 3.49722 7.51709C3.62251 7.39122 3.79244 7.3205 3.96962 7.3205L14.4479 7.29902C14.4529 7.29902 14.4574 7.30036 14.4619 7.30171C14.4664 7.30305 14.4709 7.30439 14.4759 7.30439C14.4198 7.20939 14.3525 7.12151 14.2755 7.04262L11.684 4.43903C11.5623 4.31244 11.495 4.14289 11.4965 3.96691C11.498 3.79092 11.5683 3.62257 11.6922 3.49813C11.816 3.37368 11.9836 3.30309 12.1588 3.30156C12.3339 3.30003 12.5027 3.36769 12.6287 3.48995Z"
                                          fill="var(--font-color)"/>
                                </svg>

                            </div>

                            <div class="settings-mailings-table__action pointer"
                                 @click="del(mailing)"
                            >
                                <svg width="14" height="16" viewBox="0 0 14 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M13.3 2.66667H11.13C10.9675 1.91428 10.5377 1.23823 9.91288 0.752479C9.28808 0.266727 8.50654 0.000969683 7.7 0H6.3C5.49346 0.000969683 4.71192 0.266727 4.08712 0.752479C3.46233 1.23823 3.03247 1.91428 2.87 2.66667H0.7C0.514348 2.66667 0.336301 2.7369 0.205025 2.86193C0.0737498 2.98695 0 3.15652 0 3.33333C0 3.51014 0.0737498 3.67971 0.205025 3.80474C0.336301 3.92976 0.514348 4 0.7 4H1.4V12.6667C1.40111 13.5504 1.77022 14.3976 2.42635 15.0225C3.08249 15.6474 3.97208 15.9989 4.9 16H9.1C10.0279 15.9989 10.9175 15.6474 11.5736 15.0225C12.2298 14.3976 12.5989 13.5504 12.6 12.6667V4H13.3C13.4857 4 13.6637 3.92976 13.795 3.80474C13.9263 3.67971 14 3.51014 14 3.33333C14 3.15652 13.9263 2.98695 13.795 2.86193C13.6637 2.7369 13.4857 2.66667 13.3 2.66667ZM6.3 1.33333H7.7C8.13419 1.33384 8.55759 1.46225 8.91213 1.70096C9.26667 1.93967 9.53499 2.27699 9.6803 2.66667H4.3197C4.46501 2.27699 4.73333 1.93967 5.08787 1.70096C5.44241 1.46225 5.86581 1.33384 6.3 1.33333ZM11.2 12.6667C11.2 13.1971 10.9788 13.7058 10.5849 14.0809C10.1911 14.456 9.65695 14.6667 9.1 14.6667H4.9C4.34305 14.6667 3.8089 14.456 3.41508 14.0809C3.02125 13.7058 2.8 13.1971 2.8 12.6667V4H11.2V12.6667ZM5.60015 12C5.7858 12 5.96384 11.9297 6.09512 11.8047C6.22639 11.6797 6.30014 11.5101 6.30014 11.3333V7.33331C6.30014 7.1565 6.22639 6.98693 6.09512 6.86191C5.96384 6.73689 5.7858 6.66665 5.60015 6.66665C5.41449 6.66665 5.23645 6.73689 5.10517 6.86191C4.9739 6.98693 4.90015 7.1565 4.90015 7.33331V11.3333C4.90015 11.5101 4.9739 11.6797 5.10517 11.8047C5.23645 11.9297 5.41449 12 5.60015 12ZM8.89493 11.8047C8.76366 11.9297 8.58561 12 8.39996 12C8.2143 12 8.03625 11.9297 7.90498 11.8047C7.7737 11.6797 7.69995 11.5101 7.69995 11.3333V7.33331C7.69995 7.1565 7.7737 6.98693 7.90498 6.86191C8.03625 6.73689 8.2143 6.66665 8.39996 6.66665C8.58561 6.66665 8.76366 6.73689 8.89493 6.86191C9.02621 6.98693 9.09996 7.1565 9.09996 7.33331V11.3333C9.09996 11.5101 9.02621 11.6797 8.89493 11.8047Z"
                                          fill="var(--red-color)"/>
                                </svg>

                            </div>
                        </div>
                    </td>
                </tr>

            </table>
            </div>
        </div>
    </div>
</template>

<script>
    import {useMailings} from "../../../composition/useMailings";
    import {useDate} from "../../../composition/useDate";
    import {onMounted} from 'vue';
    import {useModalConfirmDelete} from "../../../composition/useModalConfirmDelete";

    export default {
        setup(props, {emit}) {
            const { getDynamicMailings, dynamicMailings, deleteDynamicMailing, restoreDynamicMailing, stopDynamicMailing } = useMailings();
            const { setTextModalConfirmDelete, setSaveCallbackModalConfirmDelete, toggleModalConfirmDelete } = useModalConfirmDelete()

            const { validDate } = useDate();


            const del = (mailing) => {
                let callback = () => deleteDynamicMailing([mailing.dynamic_mass_sending_id])
                    .then(() => {
                        getDynamicMailings();
                    })
                setTextModalConfirmDelete(`Вы точно хотите удалить массовую рассылку "${mailing.name}"?`)
                setSaveCallbackModalConfirmDelete(callback);

                toggleModalConfirmDelete(true);
            }

            const stop = (id) => {
                stopDynamicMailing([id])
                    .then(() => {
                        getDynamicMailings();
                    })
            }
            const restore = (id) => {
                restoreDynamicMailing([id])
                    .then(() => {
                        getDynamicMailings();
                    })
            }

            const edit = (id) => {
                emit('gotoCreate', id, 2);
            }

            onMounted(() => {
                getDynamicMailings();
            })

            return {
                restore,
                stop,
                dynamicMailings,
                validDate,

                del,
                edit,
            }
        }
    }
</script>

<style lang="scss" src="./settings-mailings-table.scss"></style>